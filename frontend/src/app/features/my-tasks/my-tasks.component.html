<div class="container mx-auto px-4 py-6 max-w-7xl">
  <!-- Header Section -->
  <div class="mb-12">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h1 class="text-4xl font-semibold text-gray-900 mb-2 tracking-tight">Mis Tareas</h1>
        <p class="text-lg text-gray-500">Gestiona tus tareas asignadas</p>
      </div>

      <div class="flex gap-3">
        <button pButton label="Asignarme una tarea" icon="pi pi-inbox"
          class="p-button-outlined p-button-info rounded-xl px-6 py-3 font-medium transition-all duration-200 shadow-sm hover:shadow-md"
          routerLink="/user/bolsa-tareas"></button>
        <button pButton label="Nueva Tarea" icon="pi pi-plus"
          class="p-button-primary bg-blue-600 hover:bg-blue-700 border-0 rounded-xl px-6 py-3 font-medium transition-all duration-200 shadow-sm hover:shadow-md"
          (click)="openCreateTaskModal()"></button>
      </div>
    </div>
  </div>

  <!-- Estadísticas personales -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
    <!-- Total de Mis Tareas -->
    <div
      class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100 hover:shadow-md transition-shadow duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Total Tareas</p>
          <p class="text-4xl font-semibold text-gray-900">{{ totalMyTasks() }}</p>
        </div>
        <div class="w-14 h-14 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-check-square text-2xl text-blue-600"></i>
        </div>
      </div>
    </div>

    <!-- Tareas Pendientes -->
    <div
      class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100 hover:shadow-md transition-shadow duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Pendientes</p>
          <p class="text-4xl font-semibold text-orange-600">{{ pendingTasks() }}</p>
        </div>
        <div
          class="w-14 h-14 bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-clock text-2xl text-orange-600"></i>
        </div>
      </div>
    </div>

    <!-- Tareas Completadas -->
    <div
      class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100 hover:shadow-md transition-shadow duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Completadas</p>
          <p class="text-4xl font-semibold text-green-600">{{ completedTasks() }}</p>
        </div>
        <div
          class="w-14 h-14 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-check-circle text-2xl text-green-600"></i>
        </div>
      </div>
    </div>

    <!-- Tareas Vencidas -->
    <div
      class="bg-white rounded-2xl shadow-sm p-6 border border-gray-100 hover:shadow-md transition-shadow duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Vencidas</p>
          <p class="text-4xl font-semibold text-red-600">{{ overdueTasks() }}</p>
        </div>
        <div class="w-14 h-14 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-exclamation-circle text-2xl text-red-600"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (tasksLoading()) {
  <div class="flex items-center justify-center py-16">
    <i class="pi pi-spin pi-spinner text-5xl text-blue-600"></i>
  </div>
  }

  <!-- Empty State -->
  @if (!tasksLoading() && myTasksByEstado().length === 0) {
  <div class="bg-white rounded-2xl shadow-sm p-16 text-center border border-gray-100">
    <i class="pi pi-inbox text-7xl text-gray-300 mb-6"></i>
    <h3 class="text-2xl font-semibold text-gray-900 mb-3">No tienes tareas asignadas</h3>
    <p class="text-lg text-gray-500 mb-8">
      Comienza creando una nueva tarea o espera a que te asignen una
    </p>
    <button pButton label="Crear mi primera tarea" icon="pi pi-plus"
      class="p-button-primary bg-blue-600 hover:bg-blue-700 border-0 rounded-xl px-8 py-3 font-medium transition-all duration-200 shadow-sm hover:shadow-md"
      (click)="openCreateTaskModal()"></button>
  </div>
  }

  <!-- Kanban Board - Solo mis tareas -->
  @if (!tasksLoading() && myTasksByEstado().length > 0) {
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    @for (column of myTasksByEstado(); track column.estado.estado_id) {
    <div class="flex flex-col">
      <!-- Column Header -->
      <div class="bg-white rounded-t-2xl shadow-sm p-5 border border-b-0 border-gray-100">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-2.5 h-2.5 rounded-full" [ngClass]="{
                'bg-gray-400': column.estado.nombre === 'Pendiente',
                'bg-blue-500': column.estado.nombre === 'En Progreso',
                'bg-yellow-500': column.estado.nombre === 'En Revisión',
                'bg-green-500': column.estado.nombre === 'Completado'
              }"></div>
            <h3 class="font-semibold text-gray-900 text-base">{{ column.estado.nombre }}</h3>
          </div>
          <span
            class="px-2.5 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full min-w-[28px] text-center">
            {{ column.tasks.length }}
          </span>
        </div>
      </div>

      <!-- Column Content -->
      <div
        class="bg-gradient-to-b from-gray-50 to-white rounded-b-2xl shadow-sm border border-t-0 border-gray-100 p-4 min-h-[200px] flex-1">
        <!-- Cards -->
        <div class="flex flex-col gap-3">
          @for (task of column.tasks; track task.id) {
          <app-task-card [task]="task" (onEdit)="openEditTaskModal($event)"
            (onClick)="openDetailModal($event)"></app-task-card>
          }
        </div>
      </div>
    </div>
    }
  </div>
  }
</div>

<!-- Modal de Tarea -->
<app-task-modal 
  [visible]="modalVisible()" 
  (visibleChange)="modalVisible.set(!!$event)"
  [task]="selectedTask()" 
  [proyectos]="proyectos()" 
  [estados]="estados()"
  [prioridades]="prioridades()" 
  [usuarios]="usuarios()" 
  [userRolId]="currentUser()?.rol_id || 3"
  (onSave)="handleSaveTask($event)" 
  (onCancel)="handleCancelModal()"
  (onDelete)="handleDeleteTask($event)">
</app-task-modal>

<app-task-detail-modal 
  [visible]="detailModalVisible()" 
  (visibleChange)="detailModalVisible.set(!!$event)"
  [task]="selectedTaskForDetail()"
  (onEdit)="openEditTaskModal($event); detailModalVisible.set(false)" 
  (onClose)="detailModalVisible.set(false)">
</app-task-detail-modal>

<!-- Toast para notificaciones -->
<p-toast></p-toast>

<!-- ConfirmDialog para confirmaciones -->
<p-confirmDialog></p-confirmDialog>