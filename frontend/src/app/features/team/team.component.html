<div class="team-container px-6 py-8 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="mb-12 flex items-center justify-between">
    <div>
      <h1 class="text-4xl font-semibold text-gray-900 tracking-tight">
        {{ readOnly ? 'Directorio del Equipo' : 'Equipo' }}
      </h1>
      <p class="mt-2 text-lg text-gray-500">
        {{
        readOnly
        ? 'Información de contacto de los miembros del equipo'
        : 'Gestiona usuarios y sus roles'
        }}
      </p>
    </div>
    @if (!readOnly) {
    <button pButton icon="pi pi-plus" label="Nuevo Usuario"
      class="p-button-rounded bg-blue-600 hover:bg-blue-700 border-0 rounded-xl px-6 py-3 font-medium transition-all duration-200 shadow-sm hover:shadow-md"
      (click)="openCreateModal()"></button>
    }
  </div>

  <!-- Estadísticas -->
  <div class="mb-10 grid grid-cols-1 gap-6 md:grid-cols-4">
    <div class="rounded-2xl bg-white p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Total Usuarios</p>
          <p class="text-4xl font-semibold text-gray-900">{{ totalUsers() }}</p>
        </div>
        <div class="w-14 h-14 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-users text-2xl text-blue-600"></i>
        </div>
      </div>
    </div>

    <div class="rounded-2xl bg-white p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Activos</p>
          <p class="text-4xl font-semibold text-green-600">{{ activeUsers() }}</p>
        </div>
        <div
          class="w-14 h-14 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-check-circle text-2xl text-green-600"></i>
        </div>
      </div>
    </div>

    <div class="rounded-2xl bg-white p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Inactivos</p>
          <p class="text-4xl font-semibold text-red-600">{{ inactiveUsers() }}</p>
        </div>
        <div class="w-14 h-14 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-times-circle text-2xl text-red-600"></i>
        </div>
      </div>
    </div>

    <div class="rounded-2xl bg-white p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-500 mb-2">Administradores</p>
          <p class="text-4xl font-semibold text-purple-600">{{ adminCount() }}</p>
        </div>
        <div
          class="w-14 h-14 bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl flex items-center justify-center">
          <i class="pi pi-shield text-2xl text-purple-600"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de usuarios -->
  <div class="rounded-2xl bg-white shadow-sm border border-gray-100 overflow-hidden">
    <p-table [value]="users()" [loading]="isLoading()" [paginator]="true" [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]" [globalFilterFields]="['usuario_nombre', 'usuario_correo', 'rol_id']"
      styleClass="p-datatable-sm" [tableStyle]="{ 'min-width': '60rem' }" #dt>
      <ng-template pTemplate="caption">
        <div
          class="flex items-center justify-between p-6 bg-gradient-to-b from-gray-50 to-white border-b border-gray-100">
          <span class="p-input-icon-left w-full md:w-auto">
            <i class="pi pi-search text-gray-400"></i>
            <input pInputText type="text" placeholder="Buscar usuarios..."
              class="w-full md:w-96 rounded-xl border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all duration-200"
              (input)="dt.filterGlobal($any($event.target).value, 'contains')" />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr class="bg-gray-50 border-b border-gray-100">
          <th pSortableColumn="usuario_nombre" class="text-sm font-semibold text-gray-700 py-4 px-6">
            Nombre <p-sortIcon field="usuario_nombre"></p-sortIcon>
          </th>
          <th pSortableColumn="usuario_correo" class="text-sm font-semibold text-gray-700 py-4 px-6">
            Email <p-sortIcon field="usuario_correo"></p-sortIcon>
          </th>
          <th pSortableColumn="rol_id" class="text-sm font-semibold text-gray-700 py-4 px-6">
            Rol <p-sortIcon field="rol_id"></p-sortIcon>
          </th>
          <th pSortableColumn="usuario_estado" class="text-sm font-semibold text-gray-700 py-4 px-6">
            Estado <p-sortIcon field="usuario_estado"></p-sortIcon>
          </th>
          <th pSortableColumn="fecha_creacion" class="text-sm font-semibold text-gray-700 py-4 px-6">
            {{ readOnly ? 'Miembro desde' : 'Fecha Creación' }}
            <p-sortIcon field="fecha_creacion"></p-sortIcon>
          </th>
          @if (!readOnly) {
          <th class="text-sm font-semibold text-gray-700 py-4 px-6">Acciones</th>
          }
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user>
        <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150">
          <td class="py-4 px-6">
            <div class="flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-blue-400 to-blue-600 text-sm font-semibold text-white shadow-sm">
                {{ user.usuario_nombre.substring(0, 2).toUpperCase() }}
              </div>
              <span class="font-medium text-gray-900">{{ user.usuario_nombre }}</span>
            </div>
          </td>
          <td class="py-4 px-6 text-gray-600">{{ user.usuario_correo }}</td>
          <td class="py-4 px-6">
            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold"
              [ngClass]="getRoleBadgeClass(user.rol_id)">
              {{ getRoleName(user.rol_id) }}
            </span>
          </td>
          <td class="py-4 px-6">
            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold"
              [ngClass]="user.usuario_estado === 1 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
              {{ user.usuario_estado === 1 ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="py-4 px-6 text-gray-600 text-sm">{{ formatDate(user.fecha_creacion) }}</td>
          @if (!readOnly) {
          <td class="py-4 px-6">
            <div class="flex gap-2">
              <button pButton
                class="p-button-rounded p-button-text p-button-sm text-blue-600 hover:bg-blue-50 font-medium transition-all duration-200"
                pTooltip="Editar" tooltipPosition="top" (click)="openEditModal(user)">
                Editar
              </button>

              <button pButton class="p-button-rounded p-button-text p-button-sm font-medium transition-all duration-200"
                [style.color]="user.usuario_estado === 1 ? '#dc2626' : '#16a34a'"
                [pTooltip]="user.usuario_estado === 1 ? 'Desactivar' : 'Activar'" tooltipPosition="top"
                (click)="toggleUserStatus(user)">
                {{ user.usuario_estado === 1 ? 'Desactivar' : 'Activar' }}
              </button>

              <!-- 
              <button pButton
                class="p-button-rounded p-button-text p-button-danger p-button-sm text-red-600 hover:bg-red-50 transition-all duration-200"
                pTooltip="Eliminar" tooltipPosition="top" (click)="handleDeleteUser(user)">
                Eliminar
              </button> 
              -->
            </div>
          </td>
          }
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="readOnly ? 5 : 6" class="text-center py-16">
            <div class="flex flex-col items-center justify-center gap-4">
              <i class="pi pi-users text-6xl text-gray-300"></i>
              <p class="text-lg text-gray-500">No se encontraron usuarios</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Modal de usuario -->
<app-user-modal [visible]="modalVisible()" [user]="selectedUser()" [roles]="roles()" (save)="handleSaveUser($event)"
  (cancel)="handleCancelModal()"></app-user-modal>

<!-- Toast para notificaciones -->
<p-toast position="top-right"></p-toast>

<!-- Confirm Dialog -->
<p-confirmDialog [appendTo]="'body'"></p-confirmDialog>